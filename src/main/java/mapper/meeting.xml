<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.meetup.meeting">
	<!-- 전체 게시물 수 (crewNo 조건) -->
	<select id="selectAllMeetingByCrewNoCnt" resultType="int">
		SELECT count(*) as cnt 
		  FROM meeting
		 WHERE crewNo = #{crewNo}
	</select>
	
	<!-- 전체 게시물 수 (meetingDate 조건) -->
	<select id="selectAllMeetingByMeetingDateCnt" resultType="int">
		SELECT count(*) as cnt 
		  FROM meeting
		 WHERE meetingDate BETWEEN concat( #{date}, ' 00:00:00' ) AND concat( #{date}, ' 23:59:59' )
	</select>

	<!-- 모임별 정모 조회 -->
	<select id="selectAllMeetingByCrewNo" parameterType="Hashmap" resultType="MeetingVO">
	SELECT meetingNo, crewNo, memberNo, meetingName, meetingDate, meetingLoc, meetingPrice, meetingMax, meetingAttend, meetingStatus, meetingOriginalImg, meetingSaveImg, createdAt
	  FROM meeting
	 WHERE crewNo = #{crewNo}
	 ORDER BY meetingNo
	 LIMIT #{recordPerPage} OFFSET #{startNo};
	</select>
	
	<!-- 날짜별 정모 조회 -->
	<select id="selectAllMeetingByDate" parameterType="Hashmap" resultType="MeetingVO">
	SELECT meetingNo, crewNo, memberNo, meetingName, meetingDate, meetingLoc, meetingPrice, meetingMax, meetingAttend, meetingStatus, meetingOriginalImg, meetingSaveImg, createdAt
	  FROM meeting
<!-- 	 WHERE meetingDate BETWEEN '2024-05-21 00:00:00' AND '2024-05-21 23:59:59' -->
	 WHERE meetingDate BETWEEN concat( #{date}, ' 00:00:00' ) AND concat( #{date}, ' 23:59:59' )
	 ORDER BY meetingNo
	 LIMIT #{recordPerPage} OFFSET #{startNo};
	</select>
	
	<!-- 정모 모집 등록 -->
	<insert id="addMeeting" parameterType="MeetingVO">
		INSERT INTO meeting (crewNo, memberNo, meetingName, meetingDate, meetingLoc, meetingPrice, meetingMax, meetingOriginalImg, meetingSaveImg)
		VALUES (#{crewNo}, #{memberNo}, #{meetingName}, #{meetingDate}, #{meetingLoc}, #{meetingPrice}, #{meetingMax}, #{meetingOriginalImg}, #{meetingSaveImg})	
	</insert>
	
	<!-- 정모 삭제 (update) -->
	<update id="deleteMeeting" parameterType="Hashmap">
		UPDATE meeting
		SET meetingStatus = 0
		WHERE meetingNo = #{meetingNo}
	</update>
	
	<!-- 정모 모집 마감 (update) -->
	<update id="updateMeeting" parameterType="Hashmap">
		UPDATE meeting
		SET meetingStatus = 2
		WHERE meetingNo = #{meetingNo}
	</update>
	
	<!-- 정모 회원 추가 (정모 참가) -->
	<insert id="addMeetingMember" parameterType="MeetingMemberVO">
		INSERT INTO meeting_member (meetingNo, memberNo)
		VALUES (#{meetingNo}, #{memberNo})	
	</insert>
	
	<!-- 정모 회원 삭제 (정모 나가기) -->
	<delete id="deleteMeetingMember" parameterType="Hashmap">
		DELETE FROM meeting_member
		WHERE memberNo = #{memberNo} AND meetingNo = #{meetingNo}
	</delete>
	
	<!-- 정모참석인원 plus -->
	<update id="plusMeetingAttend" parameterType="MeetingMemberVO">
		UPDATE meeting
		SET meetingAttend = meetingAttend + 1
		WHERE meetingNo = #{meetingNo}
	</update>
	
	<!-- 정모참석인원 minus -->
	<update id="minusMeetingAttend" parameterType="Hashmap">
		UPDATE meeting
		SET meetingAttend = meetingAttend - 1
		WHERE meetingNo = #{meetingNo}
	</update>
</mapper>